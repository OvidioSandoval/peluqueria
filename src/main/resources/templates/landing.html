<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Peluquer√≠a Luna - Servicios de Belleza</title>
    <link rel="stylesheet" href="/landing-style-compact.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/vue@2"></script>
</head>
<body>
<div id="app">
    <!-- Header -->
    <header class="header">
        <nav class="navbar">
            <div class="nav-brand">
                <h1><i class="fas fa-cut"></i> Peluquer√≠a Luna</h1>
            </div>
            <ul class="nav-menu">
                <li><a href="#inicio">Inicio</a></li>
                <li><a href="/web/landing-servicios">Servicios</a></li>
                <li><a href="/web/landing-productos">Productos</a></li>
                <li v-if="tienePromociones"><a href="/web/landing-promociones">Promociones</a></li>
                <li><a href="/web/landing-contacto">Contacto</a></li>
                <li><a href="/web/login" class="user-icon"><i class="fas fa-user"></i></a></li>
            </ul>
        </nav>
    </header>

    <!-- Hero Section -->
    <section id="inicio" class="hero">
        <div class="hero-content">
            <h1>Bienvenidos a Peluquer√≠a Luna</h1>
            <p>Tu belleza es nuestra pasi√≥n. Servicios profesionales de peluquer√≠a y est√©tica.</p>
            <div class="hero-buttons">
                <a href="/web/landing-servicios" class="btn-primary">Ver Servicios</a>
                <a href="/web/landing-productos" class="btn-primary">Ver Productos</a>
                <a v-if="tienePromociones" href="/web/landing-promociones" class="btn-primary">Ver Promociones</a>
                <button class="btn-secondary" @click="abrirWhatsApp()">Ver Horarios</button>
            </div>
        </div>
    </section>

    <!-- Bot√≥n flotante de WhatsApp -->
    <div class="whatsapp-float" @click="abrirWhatsApp()">
        <i class="fab fa-whatsapp"></i>
    </div>

    <!-- Chat Web Integrado -->
    <div id="chat-container" style="display: none;">
        <div class="chat-header" @click="toggleChat">üí¨ Chat con nosotros</div>
        <div class="chat-body"></div>
        <div class="chat-footer">
            <input type="text" id="chat-input" placeholder="Escribe tu mensaje..." @keyup.enter="enviarMensajeWeb">
            <button @click="enviarMensajeWeb">Enviar</button>
        </div>
    </div>

    <button id="chat-toggle-btn" @click="toggleChat">üí¨ Chat</button>
</div>

<!-- Estilos del chat web -->
<style>
    #chat-container {
        position: fixed; bottom: 80px; right: 20px; width: 300px;
        border: 1px solid #ddd; border-radius: 10px; background: white;
        box-shadow: 0 4px 12px rgba(0,0,0,0.1); z-index: 1000; overflow: hidden;
    }
    .chat-header { background: #5F2EEA; color: white; padding: 12px; font-weight: bold; text-align: center; cursor: pointer; }
    .chat-body { height: 300px; overflow-y: auto; padding: 10px; display: flex; flex-direction: column; gap: 8px; }
    .chat-footer { display: flex; padding: 8px; border-top: 1px solid #eee; }
    #chat-input { flex: 1; padding: 8px; border: 1px solid #ccc; border-radius: 4px; outline: none; }
    #chat-input:focus { border-color: #5F2EEA; }
    #chat-toggle-btn {
        position: fixed; bottom: 20px; right: 20px; width: 60px; height: 60px;
        background: #5F2EEA; color: white; border: none; border-radius: 50%;
        font-size: 24px; cursor: pointer; z-index: 1001; display: flex;
        align-items: center; justify-content: center; box-shadow: 0 4px 12px rgba(0,0,0,0.2);
    }
    .sent { align-self: flex-end; background: #5F2EEA; color: white; max-width: 80%; padding: 8px 12px; border-radius: 15px; }
    .received { align-self: flex-start; background: #f1f1f1; color: #333; max-width: 80%; padding: 8px 12px; border-radius: 15px; }
</style>

<!-- Scripts -->
<script type="module" src="/landing-app.js"></script>

<script>
    // Funciones globales del chat web (fuera de Vue)
    function toggleChat() {
        const container = document.getElementById('chat-container');
        container.style.display = container.style.display === 'none' ? 'block' : 'none';
    }

    async function enviarMensajeWeb() {
        const input = document.getElementById('chat-input');
        const message = input.value.trim();
        if (!message) return;

        const body = document.querySelector('.chat-body');
        body.innerHTML += `<div class="sent">${message}</div>`;
        input.value = '';

        try {
            const response = await fetch('http://localhost:8080/webhook/chat-web', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ message })
            });
            const data = await response.json();
            body.innerHTML += `<div class="received">${data.reply.replace(/\n/g, '<br>')}</div>`;
        } catch (err) {
            body.innerHTML += `<div class="received">Error al conectar.</div>`;
        }

        body.scrollTop = body.scrollHeight;
    }
</script>
</body>
</html>